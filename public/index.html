<!DOCTYPE html>
<html lang="en">
<head>
    <title>Mongo</title>
</head>
<body>
    <h1>Mongo Assignment</h1>
    <div>
        <input type="text" name="user" value="">
        <button class="btn1">Add user</button>
    </div>
    <button class="btn2">List users</button>
    <div class="output"></div>
    <script>
        const input1 = document.querySelector('input[name="user"]');
        const btn1 = document.querySelector('.btn1');
        const btn2 = document.querySelector('.btn2');
        const output = document.querySelector('.output');
        const endPoint='/users';


        function createOutput(data){
            output.innerHTML = '<div>Users</div>';
            data.forEach(element => {
                console.log(element);
                const main = document.createElement('div');
                const myInput = document.createElement('input');
                myInput.setAttribute('type','text');
                myInput.value = element.name;
                main.append(myInput);
                

                const button = document.createElement('button');
                button.textContent = 'Update';
                button.style.color = 'green';
                button.addEventListener('click', ()=>{
                    element.name = myInput.value;
                    console.log(element);
                    fetch(endPoint, {
                        method: 'put',
                        body: JSON.stringify(element),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    }).then(res => res.json()).then(data => {
                        console.log(data);
                    })
                })
                main.append(button);


                output.append(main);
            })

        }

        btn2.addEventListener('click', ()=>{
            fetch(endPoint).then(res => res.json()).then(data => {
                createOutput(data);
            })
        })

        btn1.addEventListener('click', ()=>{
            const data = {name:input1.value};
            fetch(endPoint,{
                method : 'post',
                body: JSON.stringify(data),
                headers:{
                    'Content-Type' : 'application/json'
                }
            }).then(res => res.json()).then(data=>{
                console.log(data);
            })
        })
    </script>
</body>
</html>